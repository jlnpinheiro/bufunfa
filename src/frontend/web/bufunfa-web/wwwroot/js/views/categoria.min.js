var Categoria=function(){var t=function(){$.post(App.corrigirPathRota("/categorias/listar-categorias"),function(n){$("#tree").html(n)}).done(function(){$("#tree").jstree({core:{animation:!1,strings:{"New node":"Nova categoria"},themes:{responsive:!1},check_callback:!0,multiple:!1},types:{"pai-credito":{icon:"fa fa-folder"},"pai-debito":{icon:"fa fa-folder"},"folha-credito":{icon:"fa fa-tag kt-font-success"},"folha-debito":{icon:"fa fa-tag kt-font-danger"}},contextmenu:{items:function(n){return{create:{separator_after:!1,_disabled:n.parent!=2147483647&&n.parent!=-2147483648&&n.parent!="#"?!0:!1,label:"&nbsp;Novo",action:function(n){var t=$.jstree.reference(n.reference),i=t.get_node(n.reference);t.create_node(i,{},"last",function(n){setTimeout(function(){t.edit(n)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:n.id==2147483647||n.id==-2147483648?!0:!1,label:"&nbsp;Renomear",action:function(n){var t=$.jstree.reference(n.reference),i=t.get_node(n.reference);t.edit(i)}},remove:{separator_before:!1,icon:"fa fa-trash-o",separator_after:!1,_disabled:n.id==2147483647||n.id==-2147483648?!0:n.children.length>0?!0:!1,label:"&nbsp;Excluir",action:function(n){var t=$.jstree.reference(n.reference),i=t.get_node(n.reference);t.is_selected(i)?t.delete_node(t.get_selected()):t.delete_node(i)}}}}},plugins:["contextmenu","types","dnd"]}).on("select_node.jstree",function(n,t){setTimeout(function(){t.instance.show_contextmenu(t.node)},100)}).on("create_node.jstree",function(t,i){let r={IdCategoriaPai:i.node.parent,Nome:i.node.text,Tipo:i.node.parents.indexOf("2147483647")>=0?"C":"D"};$.post(App.corrigirPathRota("/categorias/cadastrar-categoria"),{entrada:r},function(n){i.instance.set_id(i.node,n.id);n.tipo=="C"?i.instance.set_type(i.node,"folha-credito"):i.instance.set_type(i.node,"folha-debito")}).fail(function(t){n();var i=Feedback.converter(t.responseJSON);i.exibir()})}).on("rename_node.jstree",function(t,i){if(i.node.type!="default"&&i.node.text!=""){var r={Id:i.node.id,IdCategoriaPai:i.node.parent,Nome:i.node.text.trim(),Tipo:i.node.type=="folha-credito"||i.node.state=="pai-credito"?"C":"D"};$.post(App.corrigirPathRota("/categorias/alterar-categoria"),{entrada:r},function(t){i.instance.set_id(i.node,t.id);t.tipo=="C"?i.instance.set_type(i.node,"folha-credito"):i.instance.set_type(i.node,"folha-debito");n()}).fail(function(t){n();var i=Feedback.converter(t.responseJSON);i.exibir()})}}).on("delete_node.jstree",function(t,i){AppModal.exibirConfirmacao("Deseja realmente excluir essa categoria?","Sim","NÃ£o",function(){$.post(App.corrigirPathRota("/categorias/excluir-categoria?id="+i.node.id),function(){n()}).fail(function(t){n();var i=Feedback.converter(t.responseJSON);i.exibir()})},function(){n()})}).on("select_node.jstree",function(n,t){$(t.node.a_attr).trigger("contextmenu")}).on("move_node.jstree",function(t,i){var r={Id:i.node.id,IdCategoriaPai:i.node.parent,Nome:i.node.text.trim(),Tipo:i.node.type=="folha-credito"||i.node.state=="pai-credito"?"C":"D"};$.post("/categorias/alterar-categoria",{entrada:r},function(t){i.instance.set_id(i.node,t.id);t.Tipo=="C"?i.instance.set_type(i.node,"folha-credito"):i.instance.set_type(i.node,"folha-debito");n()}).fail(function(t){n();var i=Feedback.converter(t.responseJSON);i.exibir()})})}).fail(function(n){var t=Feedback.converter(n.responseJSON);t.exibir()})},n=function(){$("#tree").jstree("destroy");t()};return{init:function(){t()}}}();jQuery(document).ready(function(){Categoria.init()});