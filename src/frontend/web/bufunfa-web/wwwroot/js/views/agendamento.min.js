var Agendamento=function(){var n=function(){let n={DataInicioParcela:$("#iProcurarDataInicio").val(),DataFimParcela:$("#iProcurarDataFim").val(),IdConta:$("#sProcurarConta").find(":selected").data("tipo")=="CC"?null:$("#sProcurarConta").val(),IdCartaoCredito:$("#sProcurarConta").find(":selected").data("tipo")!="CC"?null:$("#sProcurarConta").val(),IdCategoria:$("#sProcurarCategoria").val(),IdPessoa:$("#sProcurarPessoa").val(),Concluido:$("#cProcurarConcluido").prop("checked")};$.post(App.corrigirPathRota("/agendamentos/listar-agendamentos"),{filtro:n},function(n){$("#div-agendamentos").html(n);$("button[class*='alterar-agendamento']").each(function(){let n=$(this).data("id");$(this).click(function(){Bufunfa.manterAgendamento(n)})});$("button[class*='excluir-agendamento']").each(function(){let n=$(this).data("id");$(this).click(function(){AppModal.exibirConfirmacao("Deseja realmente excluir esse agendamento?","Sim","Não",function(){t(n)})})});$("button[class*='exibir-fatura']").each(function(){let n=$(this).data("id-cartao"),t=$(this).data("mes"),i=$(this).data("ano");$(this).click(function(r){r.preventDefault();Bufunfa.exibirFatura(n,t,i)})});App.aplicarTabelaSelecionavel(".table")}).done(function(){KTApp.initTooltips();KTApp.initPortlets()}).fail(function(n){let t=Feedback.converter(n.responseJSON);t.exibir()})},t=function(t){$.post(App.corrigirPathRota("/agendamentos/excluir-agendamento?id="+t),function(t){let i=Feedback.converter(t);i.tipo=="SUCESSO"&&n();i.exibir()}).fail(function(n){let t=Feedback.converter(n.responseJSON);t.exibir()})};return{init:function(){n();$("#btn-cadastrar-agendamento").click(function(){Bufunfa.manterAgendamento()});$.validator.addMethod("periodo_valido",function(){if($("#iProcurarDataInicio").val()==""&&$("#iProcurarDataFim").val()=="")return!0;let n=moment($("#iProcurarDataInicio").val(),"DD/MM/YYYY").toDate(),t=moment($("#iProcurarDataFim").val(),"DD/MM/YYYY").toDate();return n<=t},"Período inválido.");$("#form-procurar-agendamento").validate({rules:{iProcurarDataInicio:{periodo_valido:!0},iProcurarDataFim:{periodo_valido:!0}},submitHandler:function(){n()}});$(".datepicker").datepicker({autoclose:!0,language:"pt-BR",todayBtn:"linked",todayHighlight:!0});$(".datepicker").inputmask({alias:"datetime",inputFormat:"dd/mm/yyyy",placeholder:"dd/mm/aaaa",clearIncomplete:!0});Bufunfa.criarSelectContasCartoesCredito({selector:"#sProcurarConta",dropDownParentSelector:"#mProcurar",obrigatorio:!1});Bufunfa.criarSelectPeriodo({selector:"#sProcurarPeriodo",dropDownParentSelector:"#mProcurar",obrigatorio:!1,callbacks:{selecionar:function(){if($("#sProcurarPeriodo").select2("data").length){let n,t=null;$("#sProcurarPeriodo").select2("data")[0].dataInicio!=null&&$("#sProcurarPeriodo").select2("data")[0].dataFim!=null?(n=moment($("#sProcurarPeriodo").select2("data")[0].dataInicio,"DD/MM/YYYY"),t=moment($("#sProcurarPeriodo").select2("data")[0].dataFim,"DD/MM/YYYY")):(n=moment($("#sProcurarPeriodo").find(":selected").attr("data-dataInicio"),"DD/MM/YYYY"),t=moment($("#sProcurarPeriodo").find(":selected").attr("data-dataFim"),"DD/MM/YYYY"));$("#iProcurarDataInicio").datepicker("update",n.format("DD-MM-YYYY"));$("#iProcurarDataFim").datepicker("update",t.format("DD-MM-YYYY"));$("#iProcurarDataInicio").attr("disabled",!0);$("#iProcurarDataFim").attr("disabled",!0);$("#iProcurarDataInicio").valid();$("#iProcurarDataFim").valid()}else $("#iProcurarDataInicio").datepicker("clearDates"),$("#iProcurarDataFim").datepicker("clearDates"),$("#iProcurarDataInicio").attr("disabled",!1),$("#iProcurarDataFim").attr("disabled",!1)}}});Bufunfa.criarSelectCategorias({selector:"#sProcurarCategoria",dropDownParentSelector:"#mProcurar",obrigatorio:!1});Bufunfa.criarSelectPessoa({selector:"#sProcurarPessoa",dropDownParentSelector:"#mProcurar",permitirCadastro:!1,obrigatorio:!1})},atualizar:function(){n()}}}();jQuery(document).ready(function(){Agendamento.init()});